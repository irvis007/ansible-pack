---
# Hardening Role Defaults
# Provides granular control over security features

# Master hardening toggle (backward compatibility)
hardening_enabled: "{{ apply_hardening | default(true) }}"

# Granular hardening feature toggles
# These default to true but only apply when hardening_enabled is true
hardening_enable_fail2ban: true
hardening_enable_ufw: true
hardening_enable_ssh_hardening: true
hardening_enable_os_hardening: true
hardening_enable_unattended_upgrades: true
hardening_enable_suricata: false  # Optional IDS (resource intensive)

### fail2ban Configuration
fail2ban_enabled: "{{ hardening_enable_fail2ban and hardening_enabled }}"
fail2ban_bantime: 1w
fail2ban_findtime: 60m
fail2ban_maxretry: 3

### UFW Firewall Configuration
ufw_enabled: "{{ hardening_enable_ufw and hardening_enabled }}"
ufw_logging: "on"
ufw_default_incoming_policy: deny
ufw_default_outgoing_policy: allow
ufw_enable_ipv6: false

# UFW Rules - Define your firewall rules here
# Format: { rule: 'allow', port: '22', proto: 'tcp', comment: 'SSH' }
ufw_rules: []
# Example rules (override in group_vars or host_vars):
# ufw_rules:
#   - rule: allow
#     port: "{{ ssh_custom_port | default(22) }}"
#     proto: tcp
#     comment: "SSH"
#   - rule: allow
#     port: "80"
#     proto: tcp
#     comment: "HTTP"
#   - rule: allow
#     port: "443"
#     proto: tcp
#     comment: "HTTPS"

### SSH Hardening Configuration (devsec.hardening.ssh_hardening)
hardening_ssh_allow_users: "{{ ansible_user_id }}"
hardening_ssh_port: "{{ ssh_custom_port | default(22) }}"
hardening_ssh_max_auth_retries: 3
hardening_ssh_max_sessions: 2
hardening_ssh_client_alive_count: 2
hardening_ssh_print_last_log: true
hardening_ssh_sftp_enabled: false
hardening_ssh_ipv6_enabled: false

### OS Hardening Configuration (devsec.hardening.os_hardening)
hardening_os_sysctl_overwrite:
  # Enable IPv4 traffic forwarding (needed for Docker, WireGuard, etc.)
  net.ipv4.ip_forward: 1

### Unattended Upgrades Configuration
hardening_unattended_upgrades_auto_reboot: false
hardening_unattended_upgrades_auto_reboot_time: "03:00"

### Suricata IDS Configuration (optional)
suricata_enabled: "{{ hardening_enable_suricata and hardening_enabled }}"
suricata_local_rules: []
suricata_rules_dir: /etc/suricata/rules/
suricata_log_dir_certs: /var/log/suricata/certs/
suricata_log_dir: /var/log/suricata/files/
